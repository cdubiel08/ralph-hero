---
date: 2026-02-27
github_issue: 368
github_url: https://github.com/cdubiel08/ralph-hero/issues/368
plan_document: thoughts/shared/plans/2026-02-27-GH-0368-capacity-planning-estimate-aggregation.md
status: approved
type: critique
---

# GH-368 Plan Critique: Add Capacity Planning with Estimate Aggregation

## Verdict: APPROVED

The plan is well-structured, feasible, and appropriately scoped. All referenced files exist, line numbers are accurate within acceptable tolerance, and the proposed changes follow established patterns in the codebase.

## File and Line Reference Verification

### dashboard.ts

| Reference | Plan Says | Actual | Status |
|-----------|-----------|--------|--------|
| `PhaseSnapshot` interface | lines 45-58 | lines 44-58 (interface at 45, closing brace at 58) | Accurate |
| `OVERSIZED_ESTIMATES` | line 159 | line 159 | Exact match |
| `buildSnapshot()` return | lines 257-273 | lines 257-273 (return at 257, closing brace at 273) | Exact match |
| `formatMarkdown()` table header | lines 693-694 | lines 693-694 | Exact match |
| `formatMarkdown()` data row | line 712 | line 712 | Exact match |

### dashboard.test.ts

| Reference | Plan Says | Actual | Status |
|-----------|-----------|--------|--------|
| `makeItem()` helper | lines 36-49 | lines 36-49 | Exact match |
| `findPhase()` helper | lines 51-55 | lines 51-54 | Off by 1 (trivial) |
| `buildDashboard` tests | lines 921-994 | lines 921-994 | Exact match |
| `formatMarkdown` tests | lines 758-833 | lines 758-831 | Close enough |

### ralph-report/SKILL.md

| Reference | Plan Says | Actual | Status |
|-----------|-----------|--------|--------|
| Pipeline template | lines 71-73 | lines 71-73 | Exact match |

All files exist and line numbers are accurate.

## Completeness Analysis

The plan covers all necessary changes:

1. **Constant definition** (`ESTIMATE_POINTS`) - Correctly placed after `OVERSIZED_ESTIMATES` at line 159, following the same section pattern.
2. **Interface extension** (`PhaseSnapshot.estimatePoints`) - Adding a single numeric field.
3. **Aggregation logic** (`buildSnapshot()`) - Clean reduce with null/unknown safety via `?? 0`.
4. **Display update** (`formatMarkdown()`) - New "Points" column between Count and Issues.
5. **Tests** - Four test cases covering: sum per phase, null handling, empty phase, all sizes.
6. **Skill template** - `ralph-report/SKILL.md` pipeline table updated.

## Feasibility Assessment

**Code patterns are valid.** The `ESTIMATE_POINTS` constant mirrors the existing `PRIORITY_RANK` pattern (line 143) and sits logically next to `OVERSIZED_ESTIMATES`. The `reduce` pattern for summing points is idiomatic TypeScript.

**Point values are consistent.** XS=1, S=2, M=3, L=4, XL=5 matches `ESTIMATE_OPTIONS` descriptions in `project-tools.ts:97-103`.

**Null safety is handled.** The `item.estimate ? (ESTIMATE_POINTS[item.estimate] ?? 0) : 0` pattern covers both null estimates and any unrecognized estimate strings.

## Minor Observations (Non-Blocking)

1. **Manual `PhaseSnapshot` construction in tests.** The `formatMarkdown` test at line 796 manually constructs a `PhaseSnapshot` as `{ state: "Backlog", count: 1, issues: [] }`. After adding `estimatePoints` to the interface, this will need `estimatePoints: 0` added. The plan mentions updating `formatMarkdown` test assertions for table headers but does not explicitly call out this manual construction. However, TypeScript will catch this at compile time, so it is self-correcting.

2. **Per-project breakdown table.** The `formatMarkdown()` function also renders a per-project breakdown table at lines 776-779 (`| Phase | Count |`). This table does NOT include an Issues column and the plan does not mention adding Points here. This is reasonable -- the per-project breakdown is a compact summary. Worth noting but not a blocker.

3. **`formatAscii()` not updated.** The ASCII bar chart renderer (line 822) does not show points. The plan does not mention it and this is fine -- the ASCII format is a compact visualization where adding points would clutter the output.

## Scope Assessment

The "What we're NOT doing" section is well-defined and appropriately restrictive:
- No shared module extraction (premature generalization)
- No per-issue points field (redundant with estimate string)
- No dashboard-tools.ts changes (correct -- DashboardItem shape is unchanged)
- No velocity-in-points (clear scope boundary)

## Success Criteria Review

All 8 success criteria are specific and testable:
- 4 automated checks (grep + test suite)
- 4 manual verification points

The criteria are sufficient to validate the implementation.

## Conclusion

The plan is precise, well-researched, and implementation-ready. Line references are accurate, patterns are consistent with existing code, and the scope is appropriately bounded. The single minor observation (manual PhaseSnapshot construction in tests) will be caught by the TypeScript compiler during implementation.

**Recommendation: APPROVED for implementation.**
