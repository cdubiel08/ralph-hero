---
date: 2026-02-27
github_issue: 428
github_url: https://github.com/cdubiel08/ralph-hero/issues/428
plan_document: thoughts/shared/plans/2026-02-27-GH-0428-repo-filter-list-issues.md
status: approved
type: critique
---

# GH-428 Plan Critique: Add repo filter to list_issues

## Summary

The plan proposes adding an optional `repoFilter` parameter to the `list_issues` tool to enable filtering project items by source repository on multi-repo project boards. The implementation involves three focused changes to `issue-tools.ts` (GraphQL fragment, Zod schema, filter logic) plus four structural tests. No new files, no interface changes, no dependency additions.

## Technical Verification

All line references in the plan were verified against the current source:

| Claim | Verified | Notes |
|-------|----------|-------|
| `... on Issue` fragment at lines 203-214 lacks `repository` | Yes | Lines 203-214 confirmed: contains `number`, `title`, `body`, `state`, `stateReason`, `url`, `createdAt`, `updatedAt`, `labels`, `assignees` -- no `repository` field |
| `repo` config param at lines 62-65 | Yes | Lines 62-65 confirmed: `repo: z.string().optional().describe("Repository name...")` |
| `label` param at line 87 | Yes | Line 87 confirmed: `label: z.string().optional().describe("Filter by label name")` |
| Label filter pattern at lines 281-289 | Yes | Lines 281-289 confirmed: exact pattern shown in plan with `content` cast and `.filter()` chain |
| `has` filter at line 291 | Yes | Line 291-296 confirmed: `has` filter follows immediately after label filter |
| `repository` pattern in `project-tools.ts:913-921` | Yes | Lines 913-921 confirmed: `repository { nameWithOwner name owner { login } }` inside `... on Issue` |
| Test structure at `issue-tools.test.ts:128` | Yes | Line 128 confirmed: end of `exclude negation filters` describe block, suitable insertion point |

## Completeness

The plan is complete. All three code changes are specified with exact file paths, line numbers, and code snippets:

1. GraphQL fragment addition -- single line (`repository { name nameWithOwner }`)
2. Zod schema parameter -- well-defined with `.describe()` text
3. Filter logic -- full implementation provided with format detection (`/` check) and case-insensitive comparison

Test coverage is specified with four structural tests matching the existing test pattern. Verification checklist covers both automated (`npm test`, `npm run build`) and manual validation.

## Feasibility

High feasibility. The plan follows established patterns precisely:

- The GraphQL `repository` field is already used in `project-tools.ts` (verified)
- The filter logic mirrors the label filter pattern exactly (verified)
- The structural test approach matches existing tests (verified)
- No TypeScript interface changes needed due to `Record<string, unknown>` content type
- The `repoFilter` naming avoids shadowing the existing `repo` config parameter (verified distinct at lines 62-65)

## Clarity

Success criteria are specific and testable:

- Seven verification checkboxes in the desired end state
- Three automated integration test criteria
- Clear code snippets for all changes with before/after context
- Explicit rationale for design decisions (`repoFilter` vs `repo`, `name` vs `nameWithOwner` format detection)

## Scope

Well-defined boundaries. The "What We're NOT Doing" section explicitly excludes:

- Tool description string updates (Zod `.describe()` is sufficient)
- `excludeRepos` exclusion variant
- Repository data in formatted response output
- `RawProjectItem` interface modifications
- Related issues #429 (multi-repo inference) and #430 (dashboard grouping)

These exclusions are all reasonable for keeping the PR small and focused.

## Issues

No blocking issues identified.

### Minor Observations (non-blocking)

1. **DraftIssue safety**: The plan notes items without `repository` are "filtered out" by the repo filter, which is correct behavior. The research document confirms a type gate at line 237 already excludes DraftIssues before the filter chain runs, providing double safety.

2. **Performance**: Fetching `repository { name nameWithOwner }` adds two string fields per item. For 500 items this is negligible overhead.

## Verdict

**APPROVED** -- The plan is well-researched, precisely specified, and follows established codebase patterns. All technical claims verified against current source. The scope is appropriately constrained for a single-PR implementation.
