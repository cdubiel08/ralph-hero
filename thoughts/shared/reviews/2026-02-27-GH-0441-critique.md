---
date: 2026-02-27
github_issue: 441
github_url: https://github.com/cdubiel08/ralph-hero/issues/441
plan_document: thoughts/shared/plans/2026-02-27-GH-0441-repo-breakdowns-pipeline-dashboard.md
status: approved
type: critique
---

# Plan Critique: GH-441 Build and render repoBreakdowns in pipeline_dashboard

## Verdict: APPROVED

The plan is complete, feasible, and clear. All referenced line numbers and code patterns are accurate. No issues requiring iteration before implementation.

---

## Technical Verification

### Line Range Accuracy

All referenced line numbers verified against current codebase:

| Claim | Actual | Match |
|-------|--------|-------|
| `ProjectBreakdown` interface at lines 87-91 | Lines 87-91 confirmed | EXACT |
| `DashboardData` interface at lines 111-122 | Lines 111-122 confirmed | EXACT |
| `projectBreakdowns?` field at line 120 | Line 120 confirmed | EXACT |
| `projectGroups` build block at lines 622-663 | Lines 621-663 confirmed | EXACT |
| Return statement spread at ~681 | Line 681-683 confirmed | EXACT |
| `formatMarkdown()` per-project section at lines 770-813 | Lines 770-813 confirmed | EXACT |
| `formatAscii per-project` describe block ends at ~1536 | Line 1536 confirmed | EXACT |

### Interface Accuracy

`ProjectBreakdown` (lines 87-91):
```typescript
export interface ProjectBreakdown {
  projectTitle: string;
  phases: PhaseSnapshot[];
  health: { ok: boolean; warnings: HealthWarning[] };
}
```

The plan's proposed `RepoBreakdown` mirrors this exactly with `repoName` substituted for `projectTitle`. This is correct.

`DashboardData` (lines 111-122) currently has `projectBreakdowns?: Record<number, ProjectBreakdown>` at line 120, followed by `streams?: StreamDashboardSection` at line 121. The plan correctly identifies where to insert `repoBreakdowns?` (between those two fields).

### Dependency Verification

The plan correctly identifies that `DashboardItem` does not yet have a `repository` field — this is confirmed. The current `DashboardItem` interface (lines 30-42) has `projectNumber?` and `projectTitle?` but no `repository` field. The plan correctly declares GH-440 as a blocking dependency.

### Pattern Fidelity

The proposed `repoGroups` build pattern (Map<string, DashboardItem[]>) faithfully mirrors the existing `projectGroups` build pattern (Map<number, DashboardItem[]>) at lines 621-663. The only differences are the key type (string vs number) and field name, which are appropriate.

The `formatMarkdown()` insertion location (after line 813, before the streams section at line 815) is correct. The proposed code correctly adopts `localeCompare` alphabetical sort instead of the numeric sort used for projects — an appropriate distinction since repo names are strings.

---

## Completeness Assessment

All five required changes are specified with exact locations, code, and rationale:

1. `RepoBreakdown` interface — after line 91
2. `repoBreakdowns?` field on `DashboardData` — after line 120
3. Repo grouping build block in `buildDashboard()` — after line 663
4. Return object spread update — at line ~681
5. `formatMarkdown()` per-repo section — after line ~813

Test coverage is adequate: 3 `buildDashboard` tests (single-repo omit, no-repo omit, multi-repo produce) and 2 `formatMarkdown` tests (renders section, omits section). These mirror the existing `projectBreakdowns` test patterns exactly.

---

## Scope Assessment

The "What We're NOT doing" section is precise and well-justified:

- Correctly excludes `toDashboardItems()` / `DashboardItem` changes (that's GH-440)
- Correctly defers `detectCrossRepoHealth()` per issue scope
- Correctly excludes `formatAscii()` per-repo section (issue body specifies `formatMarkdown()` only)
- Correctly excludes `dashboard-tools.ts` changes (repoBreakdowns flows through DashboardData automatically — verified, the return type is `DashboardData` so the new field auto-flows)
- Correctly excludes Points column from per-repo tables (matching existing per-project pattern)

---

## Minor Observations (Non-blocking)

1. The plan states the `formatMarkdown` location is "after line ~813" — this is correct; the stream section begins at line 815, leaving exactly one logical gap. The insertion is well-placed.

2. The plan mentions `DashboardData` at "lines 87-122" in the Current State Analysis overview, but the actual ranges are 87-91 (ProjectBreakdown) and 111-122 (DashboardData). This is a cosmetic description in the overview only; the detailed sections reference the correct individual ranges.

3. The `repoBreakdowns` field placement in `DashboardData` — the plan shows it inserted between `projectBreakdowns?` and `streams?`. The actual current code has these two fields on consecutive lines (120-121), so the insertion is unambiguous.

---

## Conclusion

The plan is accurate, complete, and safe to implement. All line numbers match the current codebase. The pattern fidelity to the existing `projectBreakdowns` implementation is strong. The dependency on GH-440 is correctly identified. No blocking issues found.
