---
date: 2026-02-27
github_issue: 454
github_url: https://github.com/cdubiel08/ralph-hero/issues/454
plan_document: thoughts/shared/plans/2026-02-27-GH-0454-collapse-read-tools-merge-archive.md
status: approved
type: critique
---

# Plan Critique: GH-454 â€” Collapse Redundant Read Tools and Merge Archive

## Overall Assessment

**APPROVED** -- The plan is well-structured, thorough, and technically sound. All referenced files, functions, and line numbers have been verified against the current codebase. The plan correctly identifies 7 redundant tools, provides clear removal instructions, and includes inline code for the key extension (`includePipeline` on `get_issue`). Minor observations are noted below but none block implementation.

## Completeness

The plan covers all changes needed for this phase:

1. **`get_issue` extension with `includePipeline`** -- Steps 1-3 are detailed with inline code. The approach correctly reuses the existing `includeGroup` block, calls `getIssueFieldValues` for non-seed members, fetches sub-issue counts for oversized estimates, and runs `detectPipelinePosition()`.

2. **Tool removals (6 tools)** -- Steps 4-8 each identify the exact tool registration block with line ranges. All line numbers have been verified:
   - `detect_pipeline_position`: lines 1355-1457 (plan says ~1357-1457, close match)
   - `check_convergence`: lines 1460-1594 (plan says ~1462-1594, close match)
   - `detect_group`: lines 560-590 (plan says ~562-590, close match)
   - `detect_work_streams`: lines 593-637 (plan says ~595-637, close match)
   - `list_project_items`: lines 767-1097 (plan says ~769-1097, close match)
   - `archive_item`: lines 44-126 (plan says 44-126, exact match)

3. **`archive_item` merge into `bulk_archive`** -- Step 9 provides detailed schema changes and validation logic. The existing `archive_item` handler (lines 44-126) already supports `number`, `projectItemId`, and `unarchive`, making the merge straightforward.

4. **Test updates** -- Step 10 covers new tests for `includePipeline`, removal of tests for removed tools, and schema tests for the merged `bulk_archive`.

5. **Success criteria** -- Both automated (build, test, grep verification) and manual verification steps are defined.

## Feasibility

### Verified References

| Claim | Verified |
|-------|----------|
| `getIssueFieldValues` at line 1892 is module-scope | Yes -- lines 1892-1964, standalone `async function` |
| `get_issue` handler at lines 453-739 | Yes -- registration at 453, handler extends to ~739 |
| `includeGroup` block at lines 661-691 | Yes -- exact match |
| `return toolSuccess(...)` at ~line 693 | Yes -- line 693 starts `return toolSuccess({` |
| `computeDistance` at line 1972 only used by `check_convergence` | Yes -- only called at lines 1525 and 1562 (both inside `check_convergence`) |
| `detectPipelinePosition` imported at line 15 | Yes -- lines 14-18 import it |
| `detectWorkStreams` used by `detect_stream_positions` in `dashboard-tools.ts` | Yes -- `dashboard-tools.ts:479` registers `detect_stream_positions` which calls `detectWorkStreams` internally |
| `list_project_items` not referenced by any skill | Verified -- only referenced in `filter-profiles.ts` comments and test files |
| `bulk_archive` registration at line 1489 | Yes -- exact match at line 1490 |
| `workflowStates` currently required with `min(1)` | Yes -- line 1499: `z.array(z.string()).min(1)` |

### Implementation Correctness

- The `includePipeline` code correctly reuses the seed issue's already-fetched `workflowState` and `estimate` values rather than making redundant API calls.
- The `resolveFullConfig` call for project context is correctly scoped to `includePipeline: true` only, avoiding unnecessary project lookups when not needed.
- The best-effort try/catch pattern matches the existing `includeGroup` pattern.
- The `getIssueFieldValues` function signature at line 1892 does not take a `projectNumber` parameter -- it relies on `resolveProjectItemId` which uses the default project from the field cache. The plan's `ensureFieldCache` call before invoking `getIssueFieldValues` correctly sets up this context.

## Clarity

The plan is well-organized with numbered steps, inline code examples, and explicit "what we're NOT doing" boundaries. The implementation notes section (items 1-6) addresses edge cases proactively.

## Scope

Scope is well-defined and appropriately constrained:
- Defers skill/agent updates to Phase 5 (GH-456) -- verified that 3 files reference removed tools: `skills/ralph-hygiene/SKILL.md`, `skills/ralph-hero/SKILL.md`, `agents/ralph-analyst.md`
- Defers setup/admin tool removal to Phase 4 (GH-455)
- Does not touch `save_issue` (Phase 1, GH-452)

## Minor Observations (Non-Blocking)

1. **Tool count discrepancy**: The plan title and issue say "7 tools removed" but only 6 distinct tools are listed (detect_group, detect_pipeline_position, check_convergence, list_project_items, detect_work_streams, archive_item). The "Desired End State" section says "-7 tools + 0 new = -7". The actual count is 6 tools removed. This is a documentation inconsistency -- the count in the issue body also says "6 redundant read tools". The plan body table lists 6 rows. Implementation should follow the 6 listed tools.

2. **`check_convergence` capability reduction**: The plan correctly documents that `check_convergence` supports a caller-supplied `targetState` that the `includePipeline` approach does not replicate. The plan notes callers should "filter manually" from pipeline data. This is acceptable since the pipeline data includes `memberStates` with per-issue workflow state info.

3. **`bulk_archive` rename decision**: The plan suggests optionally renaming to `archive_items`. This should be decided before implementation to avoid a follow-up rename. Recommendation: rename now since Phase 5 will update skill references anyway.

4. **`filter-profiles.ts` comments**: Two comments reference `list_project_items` (lines 5 and 13). These should be updated when the tool is removed. The plan does not mention this -- it is trivial but worth noting for completeness.

## Verdict

**APPROVED** -- The plan is implementation-ready. The 6 tool removals are cleanly scoped, the `includePipeline` extension is well-designed with inline code, and the `archive_item` merge into `bulk_archive` is straightforward. All referenced code locations have been verified.
