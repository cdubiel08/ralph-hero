---
date: 2026-02-18
github_issue: 61
github_url: https://github.com/cdubiel08/ralph-hero/issues/61
plan_document: thoughts/shared/plans/2026-02-18-GH-0061-epic-swimlane-advance-parent.md
status: approved
type: critique
---

# Plan Critique: Epic Stays at Back of Swimlane -- advance_parent (#61)

## Overall Assessment: APPROVED

This is a well-structured plan that addresses a real systemic gap: the absence of upward state propagation for parent/epic issues. The approach (new explicit MCP tool) is the right choice over implicit side-effects in `update_workflow_state`. All file references are verified and the phasing is logical.

## Completeness

All 3 phases are clearly defined:

- **Phase 1**: New `advance_parent` tool + gate state constants in workflow-states.ts (core implementation)
- **Phase 2**: Unit tests for gate state helpers
- **Phase 3**: Wire tool into integrator agent and team-lead SKILL.md

The "What We're NOT Doing" section correctly scopes out: automatic parent advancement inside `update_workflow_state`, periodic sync, changes to `advance_children`, and dependency relationship handling.

## Technical Feasibility

### All File References Verified

1. **`advance_children` at lines 515-707**: Confirmed. Tool registration starts at line 516, implementation ends at line 707. Function closes at line 708 with `}` for `registerRelationshipTools`.
2. **workflow-states.ts helpers**: Confirmed. `isEarlierState` (line 77), `compareStates` (line 69), `stateIndex` (line 60) all exist.
3. **relationship-tools.ts imports**: Confirmed at lines 16-20. Currently imports `isValidState`, `isEarlierState`, `VALID_STATES` from workflow-states.ts. Adding `PARENT_GATE_STATES`, `isParentGateState`, `stateIndex` is a clean extension.
4. **Helper imports**: Confirmed at lines 22-29. `ensureFieldCache`, `resolveProjectItemId`, `updateProjectItemField`, `getCurrentFieldValue`, `resolveConfig`, `syncStatusField` are all already imported.
5. **ralph-integrator.md tools list**: Confirmed at line 4. `ralph_hero__advance_children` is present; adding `ralph_hero__advance_parent` is straightforward.
6. **ralph-integrator.md merge flow step 6d**: Confirmed at line 23. `advance_children(parentNumber=EPIC)` is step 6d.
7. **SKILL.md line 90**: Confirmed. "Child state advancement" note exists at line 90.

### Architecture Observations

1. **Tool placement**: Adding `advance_parent` after `advance_children` in `relationship-tools.ts` (after line 707) is correct. The file currently ends at line 708 with the closing brace of `registerRelationshipTools`. The new tool needs to be registered INSIDE this function, before the closing brace.

2. **Config resolution**: The plan says "Resolve config (owner, repo, projectNumber, projectOwner)" in step 1. The existing `advance_children` tool uses `resolveConfig` + manual project resolution (lines 546-560) rather than `resolveFullConfig`. The implementation should follow the same pattern for consistency.

3. **GraphQL for parent lookup**: The plan uses `issue.parent` in the GraphQL query. GitHub's sub-issues API supports `parent { number title state }` on Issue objects. This is correct.

4. **GraphQL for sibling lookup**: The plan uses `issue.subIssues(first: 50)`. This is correct -- GitHub sub-issues API supports this. 50 is a reasonable limit for siblings.

5. **Gate state design**: The three gate states (Ready for Plan, In Review, Done) are well-chosen. They represent natural convergence points where all children reaching the same state means the parent has progressed through a meaningful milestone.

## Clarity of Success Criteria

Each phase has automated (grep/build/test) and manual verification steps. The top-level verification checklist (lines 27-34) is comprehensive and covers all key scenarios.

## Non-Blocking Notes

1. **"Human Needed" and "Canceled" as blockers**: The plan states these children block parent advancement because they're not in `STATE_ORDER`. This is a sound design decision -- if any child is stuck in "Human Needed", the parent shouldn't advance. However, "Canceled" children arguably should NOT block advancement (a canceled child is intentionally removed from scope). Consider treating "Canceled" children as excluded from the sibling check rather than as blockers. This is a design choice worth noting but not blocking.

2. **No `advance_parent` integration test**: Phase 2 only tests the `PARENT_GATE_STATES` constant and `isParentGateState` helper. The `advance_parent` tool itself would benefit from an integration-style test (mocking the GraphQL client), similar to how `advance_children` or `batch_update` are tested. Not blocking since the tool's core logic is straightforward and the helpers are tested.

3. **Insertion point in relationship-tools.ts**: The plan says "after line 707." Line 707 is the closing `);` of the `advance_children` tool call, and line 708 is the `}` closing `registerRelationshipTools`. The new tool must be inserted between lines 707 and 708 (inside the function). The plan's description is correct but the implementer should be careful about the exact insertion point.

## Verdict

**APPROVED** -- The plan is technically sound, well-referenced, and addresses a genuine systemic gap. The gate state approach is elegant and the explicit tool design avoids the risks of implicit side effects. Proceed to implementation.
