---
date: 2026-02-16
github_issue: 30
github_url: https://github.com/cdubiel08/ralph-hero/issues/30
plan_document: thoughts/shared/plans/2026-02-16-GH-0030-create-pull-request-tool.md
status: approved
type: critique
---

# Plan Critique: GH-30 create_pull_request MCP Tool

## Verdict: APPROVED

A clean, well-scoped XS plan. All referenced files, line numbers, and patterns verified against the codebase. Single phase is appropriate for ~120 lines of new code plus type extension. No blocking issues found.

## Verification Results

All codebase references checked and confirmed accurate:

| Claim | Status | Notes |
|-------|--------|-------|
| `PullRequest` at types.ts:138-144 | Confirmed | Fields: `__typename`, `number`, `title`, `url`, `state` |
| `ProjectV2Item.content` uses `PullRequest` at types.ts:128 | Confirmed | Union type `Issue \| PullRequest \| DraftIssue \| null` |
| `create_issue` pattern at issue-tools.ts:884-1050 | Confirmed | Uses `resolveFullConfig()`, cached repo ID query, `client.mutate()` |
| `resolveConfig()` at issue-tools.ts:329-344 (not exported) | Confirmed | Private `function resolveConfig`, not `export function` |
| Second `resolveConfig()` at relationship-tools.ts:61 | Confirmed | Identical pattern, private |
| `client.mutate()` at github-client.ts:217-225 | Confirmed | Repo-level mutation, invalidates `query:` cache prefix |
| Registration at index.ts:286-294, 4 phases | Confirmed | Phase 5 goes after line 294 |
| `list_project_items` uses `PullRequest` at project-tools.ts:454 | Confirmed | Only reads `number`, `title`, `state`, `url` -- optional fields safe |
| `pr-tools.ts` does NOT exist | Confirmed | No file found |
| `gh pr create` at ralph-impl SKILL.md:209 | Confirmed | The CLI usage this tool will eventually replace |

## Minor Observations (Non-Blocking)

### 1. `resolveConfig` vs `resolveFullConfig` -- Correct Choice

The plan uses `resolveConfig()` (owner/repo only) rather than `resolveFullConfig()` (which also requires `projectNumber`/`projectOwner`). This is the right call: PR creation is a repo-level operation and should not require project configuration. The `create_issue` pattern uses `resolveFullConfig()` because it adds the issue to the project board, but PRs auto-appear via closing references. No action needed.

### 2. `fieldCache` Parameter Passed But Unused -- Consistent Pattern

The plan passes `fieldCache` to `registerPrTools()` but never references it. This is consistent with the existing registration convention: all `registerXTools` functions accept the same `(server, client, fieldCache)` signature for uniformity. The `registerViewTools` function similarly receives `fieldCache` but only uses it minimally. When #31/#32 add more PR tools, they may need it for field lookups. No action needed.

### 3. Plan Correctly Excludes Research Doc's Extra Fields

The research document (lines 197-213) proposes extending `PullRequest` with 8 fields including `mergeable` and `reviewDecision` for future issue #31. The plan correctly scopes to only the 6 fields needed for #30: `body`, `isDraft`, `headRefName`, `baseRefName`, `createdAt`, `author`. Good discipline.

### 4. Body Building Logic Covers All Edge Cases

The plan's body-building code (lines 143-151) correctly handles:
- `linkedIssueNumbers: [10, 20]` with body -> prepend `Closes` lines with blank separator
- `linkedIssueNumbers: [10]` with no body -> body is just closing refs
- No `linkedIssueNumbers` with body -> body unchanged
- Empty `linkedIssueNumbers` array -> body unchanged (`.length` check)

### 5. Cache Invalidation Is Acceptable

`client.mutate()` invalidates all `query:` prefixed cache entries. For PR creation this is appropriate -- a new PR may affect `list_project_items` results if it auto-appears on the board. Node ID lookups (`issue-node-id:*`, `project-item-id:*`) are preserved, which is correct.

### 6. `buildPrBody` Export Is a Good Testing Decision

The testing strategy (line 242) recommends extracting body-building into a pure `buildPrBody()` function exported from `pr-tools.ts`. This enables clean unit testing without GraphQL mocking, proportionate for an XS issue.

## What's Good

- **Correct scope**: Single phase for a single tool, no over-engineering
- **Accurate line references**: All 10 codebase references verified within 0-2 lines
- **Smart pattern selection**: Uses `resolveConfig()` (not `resolveFullConfig()`) since no project context needed
- **Clear "What We're NOT Doing"**: Explicitly defers #31/#32/#33 concerns, `resolveConfig` extraction, state transitions
- **Testable success criteria**: Both automated (`npm run build`, `npm test`) and manual verification listed
- **Good type extension strategy**: All new fields optional, backward-compatible by design
- **Group context documented**: Clear sequencing of #30-#33 under parent #22

## Summary

The plan is ready for implementation as-is. It follows established patterns, references accurate line numbers, and is well-bounded for XS scope. An implementer can execute this plan without ambiguity.
