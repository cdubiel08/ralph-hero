---
date: 2026-02-18
github_issue: 87
github_url: https://github.com/cdubiel08/ralph-hero/issues/87
plan_document: thoughts/shared/plans/2026-02-18-GH-0087-git-add-specific-staging.md
status: approved
type: critique
---

# GH-87 Plan Critique: Replace `git add -A` with Specific File Staging

## Verdict: APPROVED

The plan is well-structured, technically sound, and ready for implementation.

## What's Good

- **Defense-in-depth approach**: Separating guidance (SKILL.md instructions) from enforcement (PreToolUse hook) is architecturally sound. Even if the LLM ignores the instructions, the hook catches the mistake.
- **Accurate line references**: All SKILL.md references verified — `git add -A` at line 196 (Step 7) and line 319 (Address Mode A5), frontmatter Bash hooks at lines 17-20. All correct.
- **Follows established patterns**: The proposed `impl-staging-gate.sh` mirrors the structure of `impl-branch-gate.sh` exactly (source hook-utils.sh, read_input, check RALPH_COMMAND, get_field, block/allow). Consistent with codebase conventions.
- **Well-scoped "What We're NOT Doing"**: Explicitly excludes worktree isolation (covered by #85), programmatic plan parsing, and modifications to impl-branch-gate.sh. Avoids scope creep.
- **Testable success criteria**: Phase 1 criteria use concrete grep commands. Phase 2 criteria check file existence, syntax validity, and frontmatter registration. All automatable.
- **Hook ordering**: Correctly places staging gate BEFORE branch gate — catches the bad command before the branch check even runs.
- **Clear error messages**: The hook's block message guides the agent to use `git status --porcelain` and specific file staging. Good DX.
- **Naming consistency**: `impl-staging-gate.sh` follows the established `impl-*-gate.sh` pattern alongside `impl-branch-gate.sh`, `impl-state-gate.sh`, `impl-worktree-gate.sh`.

## Warnings (Non-Blocking)

### 1. Regex false positive on files ending in `-A`

The regex `git[[:space:]]+add[[:space:]]+(.*-A|...)` will match `git add my-file-A` because `.*-A` matches any string ending in `-A`, not just the `-A` flag. In practice, files named like this are extremely rare and this is unlikely to cause issues, but a more precise pattern like `(-A|.*\s-A)([[:space:]]|$)` would only match `-A` as a standalone flag.

**Severity**: Low. Edge case unlikely in real usage. Implementer may optionally tighten the regex.

### 2. Hook comment mentions `git add -u` but doesn't block it

The proposed hook comment says "git add -u (stages all tracked modified/deleted — less dangerous but still blanket)" but the regex intentionally does not block it. The inconsistency between comment (implying it should be blocked) and implementation (not blocking it) could confuse future maintainers.

**Recommendation**: Either block `-u` or reword the comment to say "Not blocked because..." to make the deliberate choice explicit.

### 3. Phase 1 success criteria grep for `git add \.` may need refinement

The Phase 1 criteria says `grep -c 'git add \.' ... returns 0` but the new Step 7 text contains the warning example "Never use `git add -A`, `git add .`, or `git add --all`" — this text contains the literal string `git add .` in the warning. The grep check would need to exclude the warning/documentation lines to avoid a false failure.

**Impact**: The implementer will need to adjust the grep check (e.g., `grep -v 'Never use' | grep -c 'git add \.'`) or the criteria description should note this.

## Technical Verification

| Claim | Status |
|-------|--------|
| `git add -A` at SKILL.md:196 | Verified (line 196) |
| `git add -A` at SKILL.md:319 | Verified (line 319) |
| `impl-branch-gate.sh` intercepts git add at line 28 | Verified (line 28: `*"git add"*`) |
| `hook-utils.sh` provides block/allow/read_input/get_field | Verified (all functions present) |
| Frontmatter Bash hooks at lines 17-20 | Verified |
| `git status --porcelain` used in review-postcondition.sh:40 | Verified |
| Plans contain File Ownership Summary tables | Verified (confirmed in research doc) |
| `RALPH_COMMAND` env var set in SKILL.md frontmatter | Verified (line 33: `RALPH_COMMAND: "impl"`) |

## Scope Assessment

- 2 phases is appropriate for this size change
- Phase boundaries are clean (SKILL.md changes vs. new hook + registration)
- XS/S estimate is reasonable — both phases are small, well-defined changes
- No missing phases or unaddressed requirements from the issue
