---
date: 2026-02-26
github_issue: 417
github_url: https://github.com/cdubiel08/ralph-hero/issues/417
plan_document: thoughts/shared/plans/2026-02-26-enforce-skill-context-for-workers.md
status: approved
type: critique
---

# Plan Critique: Enforce Skill Context for Team Workers (#417)

## Verdict: APPROVED

## Analysis

### Completeness

All 7 phases are fully defined with:
- Specific file paths and code changes
- Before/after YAML diffs for agent definitions
- Complete shell script implementations for new hooks
- Success criteria with automated verification commands

The plan covers the full scope: shared hook script (Phase 1), all three worker agents (Phases 2-3, 6), two new skills (Phases 4-5), and frontmatter parity (Phase 7).

### Feasibility

All referenced files verified to exist in the codebase:
- `plugin/ralph-hero/agents/ralph-analyst.md` - has Stop hook, tools list matches plan
- `plugin/ralph-hero/agents/ralph-builder.md` - has Stop hook, tools list matches plan
- `plugin/ralph-hero/agents/ralph-integrator.md` - has Stop hook, tools list matches plan
- `plugin/ralph-hero/hooks/scripts/hook-utils.sh` - provides `read_input`, `get_field`, `allow`, `block`, `validate_state`, `allow_with_context` used by new scripts
- `plugin/ralph-hero/hooks/scripts/set-skill-env.sh` - exists, sets RALPH_COMMAND in skill forks
- `plugin/ralph-hero/hooks/scripts/worker-stop-gate.sh` - existing Stop hook on all agents

The PreToolUse hook pattern is already proven by skill-level hooks (e.g., ralph-plan has PreToolUse matchers for Bash, Write, and update_workflow_state). Agent definitions support the same YAML format.

The `require-skill-context.sh` script uses only functions from `hook-utils.sh` (`read_input`, `get_field`, `allow`, `block`) which are stable and well-tested.

### Clarity

Success criteria are specific and testable:
- Each phase has automated verification commands (grep, test -f, test -x, bash -n)
- The testing strategy includes both enforcement tests (blocked outside skill) and pass-through tests (allowed inside skill)
- Risk assessment identifies the medium-risk area (new skills for integrator) and the key concern (gh CLI auth in forked subprocesses)

### Scope

"What We're NOT Doing" is well-defined:
- No changes to existing skill prompts or hook logic
- No modification to plugin-level hooks
- No changes to agent tools lists
- No enforcement on non-team agents
- No gating of Read/Glob/Grep/Bash
- No context: fork on orchestrators

### Minor Observations (non-blocking)

1. Phase 4 references `impl-verify-pr.sh` as a PostToolUse hook for the ralph-pr skill. This file exists but its current purpose is for the impl skill. Verify it is appropriate for PR creation context as well.

2. The Phase 7 postcondition scripts are intentionally permissive (warn-only). This is a reasonable choice for utility skills that are not pipeline-critical.

3. The plan correctly identifies that `Bash` should NOT be gated on the builder, since builders need it for git status, test runs, etc. outside skills.

## Conclusion

The plan is thorough, well-structured, and technically sound. All file references verified. The approach of a single shared hook script with per-agent PreToolUse matchers is clean and maintainable. Ready for implementation.
