---
date: 2026-02-27
github_issue: 449
github_url: https://github.com/cdubiel08/ralph-hero/issues/449
status: complete
type: research
---

# GH-449: Fix Stale Validator References and Align Agent Descriptions

## Problem Statement

The `validator` station was folded into the `integrator` during a prior refactor, but references to the old validator remain scattered across filter profiles, tests, and skill documentation. Additionally, agent descriptions across SKILL.md files and agent `.md` files follow inconsistent patterns. This is a cleanup task to remove all stale references and align descriptions.

## Current State Analysis

### Stale References Inventory

Running `grep -rn "VALIDATOR PHASE\|ralph-validator\|validator-review" plugin/ralph-hero/` (excluding `dist/` and `node_modules/`) yields exactly these matches:

1. **`plugin/ralph-hero/mcp-server/src/lib/filter-profiles.ts:43`**
   - Key `"validator-review"` in `FILTER_PROFILES` registry — maps to `{ workflowState: "Plan in Review" }`
   - This profile is used by `ralph-review` skill to find plans awaiting review

2. **`plugin/ralph-hero/mcp-server/dist/lib/filter-profiles.js:27`**
   - Compiled output — regenerated by `npm run build`, not a manual fix target

3. **`plugin/ralph-hero/mcp-server/src/__tests__/filter-profiles.test.ts`** (3 locations):
   - Line 38: test description `"validator-review filters to Plan in Review"`
   - Line 39: `FILTER_PROFILES["validator-review"]` assertion
   - Line 70: `"validator-review"` in `VALID_PROFILE_NAMES` assertion

4. **`plugin/ralph-hero/skills/ralph-review/SKILL.md`** (2 locations):
   - Line 71: `- profile: "validator-review"` in the `list_issues` call inside Step 2
   - Line 384: table row `| \`validator-review\` | \`workflowState: "Plan in Review"\` | Find plans awaiting review |`

5. **`plugin/ralph-hero/skills/ralph-hero/SKILL.md:58`**
   - `VALIDATOR PHASE (if RALPH_REVIEW_MODE == "interactive")` in the ASCII state machine diagram

### ralph-val/SKILL.md Analysis

The issue mentions "remove dead hook wiring references" from `ralph-val/SKILL.md`. Investigation shows:

- `ralph-val/SKILL.md` hooks section references `val-postcondition.sh`
- `val-postcondition.sh` **exists** at `plugin/ralph-hero/hooks/scripts/val-postcondition.sh`
- The script is **functional** — it enforces that a VALIDATION PASS/FAIL verdict is produced before stopping
- `val-postcondition.sh` is **NOT registered** in `hooks/hooks.json` (it's wired via the skill's own frontmatter `Stop` hook, which is correct)
- There are no other dead hook references in `ralph-val/SKILL.md` — `set-skill-env.sh` is a generic utility used by all skills

**Conclusion**: `ralph-val/SKILL.md` does not require changes. The `val-postcondition.sh` reference is live and correct. The issue's mention of "dead hook wiring references" may be pre-emptively resolved by the Phase 1 hook cleanup (#447), or was written conservatively. No changes needed here.

### Agent Description Consistency Audit

**Skill SKILL.md `description:` fields** — pattern check for "Use when" clause:

| Skill | Has "Use when" clause | Notes |
|-------|----------------------|-------|
| `create-plan` | Yes | Verbose, no "Use when" but descriptive |
| `draft-idea` | Yes | Has "Suggest /ralph-hero:form-idea as next step" — unique |
| `form-idea` | No "Use when" | Uses "Reads... creates..." action verbs |
| `idea-hunt` | Yes | "Use when you want to explore..." |
| `implement-plan` | Yes | "Use when you want to implement..." |
| `iterate-plan` | Yes | "Use when you want to refine..." |
| `ralph-hero` | Yes | "Use when you want to process..." |
| `ralph-hygiene` | Yes | "Use when you want to clean the board..." |
| `ralph-impl` | Yes | "Use when you want to implement..." |
| `ralph-merge` | Yes | "Use when you want to merge..." |
| `ralph-plan` | Yes | "Use when you want to plan..." |
| `ralph-pr` | Yes | "Use when you want to create a PR..." |
| `ralph-report` | No "Use when" | Action-only description |
| `ralph-research` | Yes | "Use when you want to research..." |
| `ralph-review` | Yes | "Use when you want to review..." |
| `ralph-setup` | Yes | "Use when setting up..." |
| `ralph-split` | Yes | "Use when you want to split..." |
| `ralph-status` | No "Use when" | Purely descriptive |
| `ralph-team` | Yes | "Use when you want to run a team..." |
| `ralph-triage` | Yes | "Use when you want to triage..." |
| `ralph-val` | Yes | "Use when you want to validate..." |
| `record-demo` | **No** | Short: "Record a product demo with narration and attach to a GitHub issue" — outlier |
| `research-codebase` | No "Use when" | Uses "Interactive... asks for... spawns..." |

**Agent `.md` description fields** — inconsistent patterns:

| Agent | Description Pattern |
|-------|-------------------|
| `codebase-analyzer.md` | "Analyzes... Use for..." |
| `codebase-locator.md` | "Locates... A 'Super Grep/Glob' tool..." |
| `codebase-pattern-finder.md` | "Finds... Returns..." |
| `github-analyzer.md` | "Analyzes... Produces..." |
| `github-lister.md` | "Searches... Returns..." |
| `ralph-analyst.md` | "Analyst worker - composes triage..." |
| `ralph-builder.md` | "Builder worker - reviews plans..." |
| `ralph-integrator.md` | "Integration specialist - validates..." |
| `thoughts-locator.md` | "Discovers... Use when researching..." |
| `web-search-researcher.md` | "Expert web research specialist... Use for..." |

The agent descriptions do not follow a single rigid pattern. The `ralph-analyst`, `ralph-builder`, and `ralph-integrator` agents use "Role - action verbs" which is appropriate for agent files (Claude uses these descriptions when selecting agents for Task() calls). The `codebase-*` agents and `thoughts-locator` use more varied descriptions. There is no single egregious inconsistency in agents — they are all descriptive and functional.

**Key outlier**: `record-demo/SKILL.md` has the only skill description with no "Use when" clause and no action-verb lead, but this skill is arguably out-of-scope for the issue.

## Key Discoveries

### 1. Rename Scope is Precisely Bounded

The rename `validator-review` → `review-queue` touches exactly 4 source files:
- `filter-profiles.ts` (1 location)
- `filter-profiles.test.ts` (3 locations — test name, assertion key, and VALID_PROFILE_NAMES list)
- `ralph-review/SKILL.md` (2 locations — profile call and filter table)

The `dist/` compiled output regenerates on `npm run build`.

### 2. Test Count Assertions are Safe

The test file asserts `expect(Object.keys(FILTER_PROFILES)).toHaveLength(6)` and `expect(VALID_PROFILE_NAMES).toHaveLength(6)`. The rename does not add or remove profiles — count stays at 6. Only the key name changes. Tests will pass cleanly after rename.

### 3. VALIDATOR PHASE → REVIEW PHASE is Cosmetic ASCII Art

`ralph-hero/SKILL.md` line 58 sits inside an ASCII state machine diagram. The rename is a single line change. The surrounding logic is unaffected — the condition `(if RALPH_REVIEW_MODE == "interactive")` remains correct.

### 4. ralph-val Hook Wiring is Live

`val-postcondition.sh` exists and is correctly registered via `ralph-val/SKILL.md` frontmatter (not `hooks.json`). This is the correct pattern — skill-scoped hooks go in skill frontmatter. No dead wiring exists here.

### 5. Agent Descriptions Are Functionally Adequate

No agent description is broken or misleading. The minor stylistic variations (`codebase-locator` uses a colloquial "Super Grep/Glob" metaphor; `ralph-analyst` uses "worker - composes..." shorthand) are acceptable. The issue's "consistent pattern" ask is about uniformity — not fixing broken references.

## Potential Approaches

### Option A: Minimal Rename + Targeted Description Fixes (Recommended)

1. Rename `validator-review` → `review-queue` in `filter-profiles.ts`, `filter-profiles.test.ts`, and `ralph-review/SKILL.md`
2. Rename `VALIDATOR PHASE` → `REVIEW PHASE` in `ralph-hero/SKILL.md`
3. For agent descriptions, add "Use when" clause only to the one clear outlier: `record-demo/SKILL.md`
4. Optionally normalize the 2-3 skill descriptions lacking "Use when" (ralph-report, ralph-status, form-idea, research-codebase)

**Pros**: Minimal diff, targeted, low risk, tests pass cleanly
**Cons**: Leaves minor description inconsistencies in `ralph-report`, `ralph-status`, `form-idea`, `research-codebase`

### Option B: Full Description Normalization

Same as Option A, plus add "Use when" clauses to all 4 outlier skill descriptions.

**Pros**: Complete uniformity
**Cons**: Larger diff, slightly more risk of regressing skill behavior (descriptions affect Claude's skill selection). `form-idea` and `research-codebase` descriptions are already well-written; adding "Use when" may be redundant.

## Risks

- **Low**: Profile rename may break any documentation outside the codebase that references `validator-review` — check README.md
- **Low**: The `dist/` filter-profiles.js copy will remain stale until `npm run build` is run; CI handles this
- **None**: `ralph-val/SKILL.md` does not need changes

## Acceptance Criteria Verification

After implementation, `grep -r "VALIDATOR PHASE\|ralph-validator\|validator-review" plugin/ralph-hero/` (excluding dist/) should return 0 results. Build and test pass. The `dist/` copy is excluded from the grep since it is a build artifact.

## Recommended Next Steps

1. Rename `validator-review` → `review-queue` in `filter-profiles.ts` (line 43)
2. Update all 3 references in `filter-profiles.test.ts` (lines 38, 39, 70)
3. Update 2 references in `ralph-review/SKILL.md` (lines 71, 384)
4. Rename `VALIDATOR PHASE` → `REVIEW PHASE` in `ralph-hero/SKILL.md` (line 58)
5. Skip `ralph-val/SKILL.md` — no dead hooks
6. For agent descriptions: add "Use when" to `record-demo/SKILL.md`; optionally normalize `ralph-report`, `ralph-status` — leave `form-idea` and `research-codebase` as-is (their descriptions are clear)
7. Run `npm test` and `npm run build` to verify

## Files Affected

### Will Modify
- `plugin/ralph-hero/mcp-server/src/lib/filter-profiles.ts` - Rename `validator-review` → `review-queue`
- `plugin/ralph-hero/mcp-server/src/__tests__/filter-profiles.test.ts` - Update 3 `validator-review` references
- `plugin/ralph-hero/skills/ralph-review/SKILL.md` - Update 2 `validator-review` references
- `plugin/ralph-hero/skills/ralph-hero/SKILL.md` - Rename `VALIDATOR PHASE` → `REVIEW PHASE`
- `plugin/ralph-hero/skills/record-demo/SKILL.md` - Add "Use when" to description (optional, outlier)

### Will Read (Dependencies)
- `plugin/ralph-hero/hooks/hooks.json` - Verify no validator-review profile references (confirmed: none)
- `plugin/ralph-hero/hooks/scripts/val-postcondition.sh` - Verify still live (confirmed: exists and functional)
- `plugin/ralph-hero/agents/ralph-integrator.md` - Verify no stale references (confirmed: none)
